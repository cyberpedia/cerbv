# Loki Configuration for Log Aggregation

auth_enabled: false

server:
  http_listen_port: 3100
  grpc_listen_port: 9096
  log_level: info

common:
  path_prefix: /loki
  storage:
    filesystem:
      chunks_directory: /loki/chunks
      rules_directory: /loki/rules
  replication_factor: 1

limits_config:
  max_cache_freshness_per_query: 10m
  max_query_parallelism: 32
  volume_status_enabled: true

chunk_store_config:
  max_look_back_period: 720h  # 30 days retention

# Index configuration
index:
  period: 24h
  prefix: index_

# Storage backend (filesystem for single node)
storage_config:
  filesystem:
    directory: /loki/chunks

# Configuration for receiving logs via Promtail
ingester:
  lifecycler:
    ring:
      kvstore:
        store: inmemory
      replication_factor: 1
  chunk_idle_period: 30m
  chunk_block_size: 262144
  chunk_retain_period: 1m
  max_transfer_retries: 0

# Query scheduler (for scaling)
# query_scheduler:
#   grpc_listen_port: 3101

# Querier configuration
querier:
  max_concurrent: 16
  query_timeout: 300s

# Frontend configuration
frontend:
  compress_responses: true
  log_requests_long: 30s

# Compactor for storage optimization
compactor:
  working_directory: /loki/compactor
  compaction_interval: 10m
  retention_enabled: true
  retention_delete_delay: 2h
  retention_delete_worker_count: 3

# Analytics
analytics:
  reporting_enabled: false
